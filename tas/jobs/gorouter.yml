---
name: gorouter
release: routing
manifest: |
  uaa:
    clients:
      gorouter:
        secret: (( .uaa.gorouter_client_credentials.password ))
    ca_cert: (( $ops_manager.ca_certificate ))
    ssl:
      port: 8443
  request_timeout_in_seconds: (( .router.request_timeout_in_seconds.value ))
  router:
    http_rewrite:
      responses:
        remove_headers: (( .properties.router_headers_remove_if_specified.value ))
    balancing_algorithm: (( .properties.router_balancing_algorithm.value ))
    backends:
      max_conns: (( .properties.router_backend_max_conn.value ))
      enable_tls: true
      cert_chain: (( .properties.routing_backends_client_cert_with_san.cert_pem ))
      private_key: (( .properties.routing_backends_client_cert_with_san.private_key_pem ))
    ca_certs: |
      (( .properties.routing_custom_ca_certificates.value ))
      (( $ops_manager.ca_certificate ))
      ((( /services/tls_leaf.ca )))
      ((( diego-instance-identity-intermediate-ca-2-7.ca )))
      (( .properties.network_policy_server_external_cert.cert_pem ))
    forwarded_client_cert: (( .properties.routing_tls_termination.selected_option.parsed_manifest(gorouter_forwarded_client_cert) ))
    disable_log_forwarded_for: (( .properties.routing_log_client_ips.selected_option.parsed_manifest(disable_log_forwarded_for) ))
    disable_log_source_ips: (( .properties.routing_log_client_ips.selected_option.parsed_manifest(disable_log_source_ips) ))
    max_idle_connections: (( .properties.router_keepalive_connections.selected_option.parsed_manifest(max_idle_connections) ))
    client_cert_validation: (( .properties.router_client_cert_validation.selected_option.parsed_manifest(client_cert_validation) ))
    enable_proxy: (( .properties.router_enable_proxy.value ))
    route_services_secret: (( .properties.route_services.selected_option.parsed_manifest(secret) ))
    route_services_internal_lookup: (( .properties.route_services.selected_option.parsed_manifest(internal_lookup) ))
    ssl_skip_validation: (( .ha_proxy.skip_cert_verify.value ))
    drain_wait: (( .router.drain_wait.value ))
    drain_timeout: (( .router.drain_timeout.value ))
    tracing:
      enable_zipkin: (( .router.enable_zipkin.value ))
    write_access_logs_locally: (( .router.enable_write_access_logs.value ))
    secure_cookies: (( .router.disable_insecure_cookies.value ))
    load_balancer_healthy_threshold: (( .router.lb_healthy_threshold.value ))
    extra_headers_to_log: (( .router.extra_headers_to_log.parsed_strings ))
    routing_table_sharding_mode: '(( .router.enable_isolated_routing.value ? "shared-and-segments" : "all" ))'
    status:
      user: ((( router-status-credentials.username )))
      password: ((( router-status-credentials.password )))
    cipher_suites: (( .properties.gorouter_ssl_ciphers.value ))
    disable_http: (( .properties.routing_disable_http.value ))
    enable_ssl: true
    tls_pem: (( .properties.networking_poe_ssl_certs.parsed_manifest(routing_certificates_and_private_keys) ))
    min_tls_version: (( .properties.routing_minimum_tls_version.selected_option.parsed_manifest(min_tls_version) ))
    frontend_idle_timeout: (( .router.frontend_idle_timeout.value ))
    sticky_session_cookie_names: (( .properties.router_sticky_session_cookie_names.parsed_manifest(sticky_session_cookie_names) ))
    logging:
      format:
        timestamp: (( .properties.logging_timestamp_format.selected_option.parsed_manifest(rfc3339_or_deprecated) ))
  routing_api:
    enabled: true
