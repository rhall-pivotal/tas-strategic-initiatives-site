---
- name: service_discovery_client_tls
  type: rsa_cert_credentials
  configurable: false
  default:
    domains:
    - service-discovery-controller.service.cf.internal

- name: service_discovery_server_tls
  type: rsa_cert_credentials
  configurable: false
  default:
    domains:
    - service-discovery-controller.service.cf.internal

- name: networking_poe_ssl_certs
  type: collection
  configurable: true
  property_blueprints:
  - name: name
    type: string
    configurable: true
  - name: certificate
    type: rsa_cert_credentials
    configurable: true
  named_manifests:
  - name: routing_certificates_and_private_keys
    manifest: |
      cert_chain: (( current_record.certificate.cert_pem ))
      private_key: (( current_record.certificate.private_key_pem ))

- name: routing_custom_ca_certificates
  type: text
  configurable: true
  optional: true

- name: routing_disable_http
  type: boolean
  configurable: true
  default: false

- name: routing_minimum_tls_version
  type: selector
  configurable: true
  default: tls_v1_2
  option_templates:
    - name: tls_v1_0
      select_value: tls_v1_0
      named_manifests:
        - name: min_tls_version
          manifest: |
            TLSv1.0
        - name: disable_tls_10
          manifest: |
            false
        - name: disable_tls_11
          manifest: |
            false
    - name: tls_v1_1
      select_value: tls_v1_1
      named_manifests:
        - name: min_tls_version
          manifest: |
            TLSv1.1
        - name: disable_tls_10
          manifest: |
            true
        - name: disable_tls_11
          manifest: |
            false
    - name: tls_v1_2
      select_value: tls_v1_2
      named_manifests:
        - name: min_tls_version
          manifest: |
            TLSv1.2
        - name: disable_tls_10
          manifest: |
            true
        - name: disable_tls_11
          manifest: |
            true

- name: routing_log_client_ips
  type: selector
  configurable: true
  default: log_client_ips
  option_templates:
    - name: log_client_ips
      select_value: log_client_ips
      named_manifests:
        - name: disable_log_forwarded_for
          manifest: |
            false
        - name: disable_log_source_ips
          manifest: |
            false
    - name: disable_x_forwarded_for
      select_value: disable_x_forwarded_for
      named_manifests:
        - name: disable_log_forwarded_for
          manifest: |
            true
        - name: disable_log_source_ips
          manifest: |
            false
    - name: disable_all_log_client_ips
      select_value: disable_all_log_client_ips
      named_manifests:
        - name: disable_log_forwarded_for
          manifest: |
            true
        - name: disable_log_source_ips
          manifest: |
            true

- name: routing_tls_termination
  type: selector
  default: load_balancer
  configurable: true
  option_templates:
    - name: load_balancer
      select_value: load_balancer
      named_manifests:
        - name: gorouter_forwarded_client_cert
          manifest: |
            always_forward
    - name: ha_proxy
      select_value: ha_proxy
      named_manifests:
        - name: gorouter_forwarded_client_cert
          manifest: |
            forward
    - name: router
      select_value: router
      named_manifests:
        - name: gorouter_forwarded_client_cert
          manifest: |
            sanitize_set

- name: haproxy_client_cert_validation
  type: selector
  configurable: true
  default: none
  option_templates:
    - name: none
      select_value: none
      named_manifests:
        - name: client_cert_validation
          manifest: |
            false
    - name: request
      select_value: request
      named_manifests:
        - name: client_cert_validation
          manifest: |
            true

- name: router_client_cert_validation
  type: selector
  configurable: true
  default: request
  option_templates:
    - name: none
      select_value: none
      named_manifests:
        - name: client_cert_validation
          manifest: |
            none
    - name: request
      select_value: request
      named_manifests:
        - name: client_cert_validation
          manifest: |
            request
    - name: require
      select_value: require
      named_manifests:
        - name: client_cert_validation
          manifest: |
            require

- name: gorouter_ssl_ciphers
  type: text
  configurable: true
  default: "ECDHE-RSA-AES128-GCM-SHA256:TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"

- name: haproxy_client_certificate
  type: rsa_cert_credentials
  configurable: false

- name: haproxy_forward_tls
  type: selector
  configurable: true
  default: enable
  option_templates:
  - name: enable
    select_value: enable
    named_manifests:
      - name: backend_port
        manifest: |
          443
      - name: backend_ssl
        manifest: |
          "verify"
    property_blueprints:
    - name: backend_ca
      type: text
      configurable: true
  - name: disable
    select_value: disable
    named_manifests:
      - name: backend_port
        manifest: |
          80
      - name: backend_ssl
        manifest: |
          "off"

- name: haproxy_hsts_support
  type: selector
  configurable: true
  default: disable
  option_templates:
  - name: enable
    select_value: enable
    named_manifests:
      - name: hsts_enable
        manifest: |
          true
      - name: hsts_include_subdomains
        manifest: |
          (( .properties.haproxy_hsts_support.enable.include_subdomains.value ))
      - name: hsts_max_age
        manifest: |
          (( .properties.haproxy_hsts_support.enable.max_age.value ))
      - name: hsts_preload
        manifest: |
          (( .properties.haproxy_hsts_support.enable.enable_preload.value ))
    property_blueprints:
    - name: max_age
      type: integer
      configurable: true
      default: 31536000
    - name: include_subdomains
      type: boolean
      configurable: true
      default: false
    - name: enable_preload
      type: boolean
      configurable: true
      default: false
  - name: disable
    select_value: disable
    named_manifests:
      - name: hsts_enable
        manifest: |
          false
      - name: hsts_include_subdomains
        manifest: |
          false
      - name: hsts_max_age
        manifest: |
          0
      - name: hsts_preload
        manifest: |
          false

- name: haproxy_max_buffer_size
  type: integer
  configurable: true
  default: 16384

- name: haproxy_ssl_ciphers
  type: text
  configurable: true
  default: "DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384"

- name: tcp_routing
  type: selector
  configurable: true
  default: disable
  option_templates:
  - name: disable
    select_value: disable
    named_manifests:
      - name: default_router_group
        manifest: |
          []
      - name: tcp_router_request_timeout_in_seconds
        manifest: |
          (( .properties.tcp_routing.enable.request_timeout_in_seconds.value ))
  - name: enable
    select_value: enable
    named_manifests:
      - name: default_router_group
        manifest: |
          - name: default-tcp
            reservable_ports: (( .properties.tcp_routing.enable.reservable_ports.value ))
            type: tcp
      - name: tcp_router_request_timeout_in_seconds
        manifest: |
          (( .properties.tcp_routing.enable.request_timeout_in_seconds.value ))
    property_blueprints:
      - name: reservable_ports
        type: string
        configurable: true
        placeholder: "e.g: 1024-10000,65535"
      - name: request_timeout_in_seconds
        type: integer
        configurable: true
        default: 300
        constraints:
          min: 0

- name: router_backend_max_conn
  type: integer
  configurable: true
  default: 500

- name: router_keepalive_connections
  type: selector
  configurable: true
  default: enable
  option_templates:
    - name: enable
      select_value: enable
      named_manifests:
        - name: max_idle_connections
          manifest: |
            49000
    - name: disable
      select_value: disable
      named_manifests:
        - name: max_idle_connections
          manifest: |
            0

- name: route_services
  type: selector
  configurable: true
  default: enable
  option_templates:
    - name: enable
      select_value: enable
      named_manifests:
        - name: secret
          manifest: |
            ((( router-route-services-secret )))
        - name: internal_lookup
          manifest: |
            (( .properties.route_services.enable.internal_lookup.value ))
      property_blueprints:
        - name: ignore_ssl_cert_verification
          type: boolean
          configurable: true
          default: false
        - name: internal_lookup
          type: boolean
          configurable: true
          default: false
    - name: disable
      select_value: disable
      named_manifests:
        - name: secret
          manifest: |
        - name: internal_lookup
          manifest: |
            false

- name: experimental_dynamic_egress_enforcement
  type: boolean
  configurable: true
  default: false

- name: router_enable_proxy
  type: boolean
  configurable: true
  default: false

- name: network_policy_server_cert
  type: rsa_cert_credentials
  default:
    domains:
      - network-policy-server.service.cf.internal
      - "*.network-policy-server.service.cf.internal"

- name: network_policy_server_external_cert
  type: rsa_cert_credentials
  default:
    domains:
      - network-policy-server.service.cf.internal

- name: network_policy_agent_cert
  type: rsa_cert_credentials

- name: container_networking
  type: selector
  configurable: true
  default: enable
  option_templates:
  - name: enable
    select_value: enable
  - name: disable
    select_value: disable

- name: container_networking_interface_plugin
  type: selector
  configurable: true
  default: silk
  option_templates:
  - name: silk
    select_value: silk
    property_blueprints:
    - name: network_mtu
      type: integer
      configurable: true
      default: 1454
    - name: network_cidr
      type: string
      configurable: true
      optional: true
    - name: vtep_port
      type: integer
      configurable: true
      default: 4789
    - name: iptables_denied_logs_per_sec
      type: integer
      configurable: true
      default: 1
    - name: iptables_accepted_udp_logs_per_sec
      type: integer
      configurable: true
      default: 100
    - name: enable_log_traffic
      type: boolean
      configurable: true
      default: false
    - name: enable_policy_enforcement
      type: boolean
      configurable: true
      default: true
    named_manifests:
      - name: disable_silk
        manifest: |
          false
      - name: use_container_address
        manifest: |
          false
      - name: cni_config_dir
        manifest: |
          /var/vcap/jobs/silk-cni/config/cni
      - name: cni_plugin_dir
        manifest: |
          /var/vcap/packages/silk-cni/bin

  - name: external
    select_value: external
    named_manifests:
      - name: disable_silk
        manifest: |
          true
      - name: use_container_address
        manifest: |
          true
      - name: cni_config_dir
        manifest: |
          /var/vcap/jobs/cni/config/cni
      - name: cni_plugin_dir
        manifest: |
          /var/vcap/packages/cni/bin

- name: cf_networking_database_connection_timeout
  type: integer
  configurable: true
  default: 120
  constraints:
    min: 120

- name: cf_networking_enable_space_developer_self_service
  type: boolean
  configurable: true
  default: false

- name: cf_networking_search_domains
  type: string_list
  configurable: true
  optional: true

- name: cf_networking_internal_domains
  type: collection
  configurable: true
  default:
  - name: apps.internal
  property_blueprints:
  - name: name
    type: string
    configurable: true
  named_manifests:
  - name: for_bosh_dns_adapter
    manifest: |
      (( current_record.name.value ))
  - name: for_cloud_controller_ng
    manifest: |
      name: (( current_record.name.value ))
      internal: true

- name: routing_backends_client_cert_with_san
  type: rsa_cert_credentials
  configurable: false
  default:
    domains:
    - gorouter.service.cf.internal

- name: copilot_server_cert
  type: rsa_cert_credentials
  configurable: false
  default:
    domains:
    - copilot.service.cf.internal

- name: pilot_server_cert
  type: rsa_cert_credentials
  configurable: false
  default:
    domains:
    - pilot.service.cf.internal

- name: copilot_client_cert
  type: rsa_cert_credentials
  configurable: false
  default:
    domains:
    - copilot.service.cf.internal

- name: routing_api_server_cert
  type: rsa_cert_credentials
  configurable: false
  default:
    domains:
    - routing-api.service.cf.internal

- name: routing_api_client_cert
  type: rsa_cert_credentials
  configurable: false
  default:
    domains:
    - routing-api.service.cf.internal

- name: router_headers_remove_if_specified
  type: collection
  configurable: true
  optional: true
  property_blueprints:
  - name: name
    type: string
    configurable: true

- name: router_sticky_session_cookie_names
  type: collection
  configurable: true
  optional: true
  property_blueprints:
  - name: name
    type: string
    configurable: true
  named_manifests:
   - name: sticky_session_cookie_names
     manifest: (( current_record.name.value ))

- name: router_balancing_algorithm
  type: selector
  configurable: true
  default: round-robin
  option_templates:
    - name: round_robin
      select_value: round-robin
    - name: least_connection
      select_value: least-connection

