---
name: ssh_proxy
release: diego
manifest: |
  bpm:
    enabled: true
  connect_to_instance_address: (( .properties.container_networking_interface_plugin.selected_option.parsed_manifest(use_container_address) ))
  backends:
    tls:
      enabled: true
      ca_certificates:
      - ((( diego-instance-identity-intermediate-ca-2-7.ca )))
      client_certificate: (( .properties.ssh_proxy_backends_tls.cert_pem ))
      client_private_key: (( .properties.ssh_proxy_backends_tls.private_key_pem ))
  diego:
    ssh_proxy:
      disable_healthcheck_server: true
      bbs:
        ca_cert: (( $ops_manager.ca_certificate ))
        client_cert: (( .properties.bbs_client_cert.cert_pem ))
        client_key: (( .properties.bbs_client_cert.private_key_pem ))
      enable_cf_auth: true
      host_key: (( .diego_brain.ssh_host_key.private_key_pem ))
      uaa:
        ca_cert: (( $ops_manager.ca_certificate ))
      uaa_secret: (( .uaa.ssh_proxy_client_credentials.password ))
    ssl:
      skip_cert_verify: (( .ha_proxy.skip_cert_verify.value ))
  enable_consul_service_registration: false
  logging:
    format:
      timestamp: (( .properties.diego_log_timestamp_format.selected_option.parsed_manifest(timestamp_format) ))
  loggregator:
    use_v2_api: true
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.loggregator_client_cert.cert_pem ))
    key: (( .properties.loggregator_client_cert.private_key_pem ))
